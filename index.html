<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Data Explorer</title>
    
    <!-- ======================================================= -->
    <!-- PASTE CONTENTS OF loader_snippet.html HERE -->
    <script src="data_chunks/games_db_part_1.js"></script>
    <script src="data_chunks/games_db_part_2.js"></script>
    <script src="data_chunks/games_db_part_3.js"></script>
    <script src="data_chunks/games_db_part_4.js"></script>
    
    <!-- Fallback if script wasn't run (remove this if you have real data) -->
    <script>if(typeof window.GAMES_DB === 'undefined') window.GAMES_DB = [];</script>
    <!-- ======================================================= -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #131829;
            --bg-tertiary: #1a1f3a;
            --bg-card: #1e2540;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: rgba(148, 163, 184, 0.1);
            --success: #10b981;
            --warning: #f59e0b;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-primary);
            color: var(--text-primary); 
            display: flex; 
            height: 100vh; 
            overflow: hidden;
            position: relative;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { 
            background: rgba(148, 163, 184, 0.3); 
            border-radius: 10px;
            transition: background 0.2s;
        }
        ::-webkit-scrollbar-thumb:hover { background: rgba(148, 163, 184, 0.5); }

        /* LAYOUT */
        #app-container {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
            z-index: 1;
        }

        #sidebar { 
            width: 380px; 
            background: var(--bg-secondary);
            border-right: 1px solid var(--border); 
            display: flex; 
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        #main { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            background: var(--bg-primary);
        }

        /* HEADER */
        .app-header {
            padding: 24px 32px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }

        .app-header h1 {
            font-size: 28px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .app-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* SEARCH BOX */
        #search-box { 
            padding: 24px 20px 20px;
        }

        .search-wrapper {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        #search-input { 
            width: 100%; 
            padding: 14px 16px 14px 46px;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            color: var(--text-primary);
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        #search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-card);
            box-shadow: var(--shadow-glow);
        }

        #search-input::placeholder {
            color: var(--text-muted);
        }

        /* FILTER TOGGLE */
        .filter-toggle-section {
            padding: 0 20px 16px;
        }

        .filter-toggle-btn {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .filter-toggle-btn:hover {
            background: var(--bg-card);
            border-color: var(--accent-primary);
        }

        .filter-toggle-btn.active {
            background: var(--accent-gradient);
            border-color: transparent;
            color: white;
        }

        .filter-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* APPLIED FILTERS DISPLAY */
        .applied-filters {
            padding: 0 20px 16px;
            display: none;
        }

        .applied-filters.show {
            display: block;
        }

        .applied-filter-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 8px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .applied-filter-label {
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .applied-filter-value {
            color: var(--accent-primary);
            font-weight: 500;
            flex: 1;
            text-align: right;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .applied-filter-clear {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 16px;
            line-height: 1;
            transition: all 0.2s;
        }

        .applied-filter-clear:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* FILTER SIDE PANEL */
        #filter-panel-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 999;
            animation: fadeIn 0.3s ease;
        }

        #filter-panel-overlay.show {
            display: block;
        }

        #filter-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 480px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            box-shadow: -10px 0 50px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #filter-panel.show {
            right: 0;
        }

        .filter-panel-header {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 24px;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .filter-panel-title {
            font-size: 24px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .filter-panel-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .filter-panel-close {
            position: absolute;
            top: 24px;
            right: 24px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
        }

        .filter-panel-close:hover {
            background: var(--bg-card);
            border-color: var(--accent-primary);
        }

        .filter-panel-content {
            padding: 24px;
        }

        .filter-panel-actions {
            position: sticky;
            bottom: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: 20px 24px;
            display: flex;
            gap: 12px;
        }

        .filter-panel-btn {
            flex: 1;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .filter-panel-btn-primary {
            background: var(--accent-gradient);
            color: white;
        }

        .filter-panel-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        .filter-panel-btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .filter-panel-btn-secondary:hover {
            background: var(--bg-card);
        }
        
        .filter-group { 
            margin-bottom: 20px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .filter-group:hover {
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: var(--shadow-md);
        }

        .filter-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 12px;
        }

        .filter-label { 
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase; 
            letter-spacing: 0.8px; 
            font-weight: 600;
        }

        .filter-action { 
            font-size: 12px;
            color: var(--accent-primary);
            cursor: pointer;
            background: none;
            border: none;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s;
            font-weight: 500;
        }

        .filter-action:hover { 
            background: rgba(99, 102, 241, 0.1);
        }

        /* PLATFORM SEARCH & LIST */
        #platform-search {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 13px;
            border-radius: 8px;
            outline: none;
            margin-bottom: 8px;
            font-family: inherit;
            transition: all 0.2s;
        }

        #platform-search:focus {
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
        }

        #platform-search::placeholder { 
            color: var(--text-muted);
        }
        
        .checkbox-container {
            max-height: 200px;
            overflow-y: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 4px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: var(--text-primary);
        }

        .checkbox-item:hover { 
            background: var(--bg-tertiary);
        }

        .checkbox-item input { 
            margin-right: 12px;
            accent-color: var(--accent-primary);
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        .checkbox-item.hidden { 
            display: none !important;
        }

        /* NUMBER INPUT */
        input[type="number"] {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 14px;
            border-radius: 8px;
            width: 100%;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s;
        }

        input[type="number"]:focus { 
            outline: none;
            border-color: var(--accent-primary);
        }

        .filter-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
            line-height: 1.4;
        }

        /* DATE INPUTS */
        .date-row { 
            display: flex;
            gap: 12px;
        }

        .date-col { 
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .date-col label { 
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        input[type="date"] {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 12px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 13px;
            color-scheme: dark;
            transition: all 0.2s;
        }

        input[type="date"]:focus { 
            outline: none;
            border-color: var(--accent-primary);
        }

        /* Results Count */
        #results-count { 
            padding: 16px 20px;
            font-size: 13px;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .result-number {
            color: var(--accent-primary);
            font-weight: 700;
        }

        .results-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        .export-btn:active {
            transform: translateY(0);
        }

        /* Export Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .export-option {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .export-option:hover {
            border-color: var(--accent-primary);
            background: var(--bg-card);
            transform: translateX(4px);
        }

        .export-option-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .export-option-content {
            flex: 1;
        }

        .export-option-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .export-option-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .modal-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .modal-btn-cancel {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .modal-btn-cancel:hover {
            background: var(--bg-card);
        }

        #game-list { 
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .game-item { 
            padding: 16px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.2s;
            margin-bottom: 6px;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
        }

        .game-item:hover { 
            background: var(--bg-card);
            border-color: var(--accent-primary);
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
        }

        .game-item.active { 
            background: var(--accent-gradient);
            border-color: transparent;
            box-shadow: var(--shadow-glow);
        }

        .game-item.active .game-title,
        .game-item.active .game-meta {
            color: white;
        }

        .game-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .game-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .source-badge { 
            font-size: 11px;
            background: var(--success);
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            font-weight: 600;
        }

        /* HEADER & TABS */
        #header { 
            padding: 32px 40px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        h1 { 
            font-size: 32px;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #tabs { 
            display: flex;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0 32px;
            overflow-x: auto;
            gap: 4px;
        }

        .tab-btn { 
            padding: 16px 24px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.3px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-btn:hover { 
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .tab-btn.active { 
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        /* CONTENT PANELS */
        #panels-container { 
            flex: 1;
            overflow-y: auto;
            padding: 40px;
        }

        .panel { 
            display: none;
            max-width: 1600px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease;
        }

        .panel.active { 
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* VISUAL OVERVIEW STYLES */
        .dashboard-grid { 
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 40px;
        }

        .dashboard-left {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .poster-card { 
            width: 100%;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
        }

        .poster-card img { 
            width: 100%;
            display: block;
        }
        
        .data-table { 
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            font-size: 14px;
            border: 1px solid var(--border);
        }

        .data-table th, .data-table td { 
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table tr:last-child th,
        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table th { 
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            font-weight: 600;
            width: 40%;
        }

        .data-table td {
            color: var(--text-primary);
        }
        
        .section-title { 
            font-size: 18px;
            color: var(--accent-primary);
            margin-bottom: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--accent-gradient);
            border-radius: 2px;
        }
        
        .stats-row { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card { 
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-value { 
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .stat-label { 
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .pill-container { 
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .pill { 
            background: var(--bg-card);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .pill:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .pill.genre { 
            color: var(--success);
            border-color: rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.1);
        }

        .pill.platform { 
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .pill a { 
            text-decoration: none;
            color: inherit;
        }

        /* CREDITS */
        .bfi-grid { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .bfi-card { 
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 16px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
        }

        .bfi-card:hover {
            background: rgba(99, 102, 241, 0.15);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .bfi-role { 
            color: var(--accent-primary);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .bfi-name { 
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .credits-grid { 
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .credits-grid.show { 
            display: grid;
        }

        .credit-item { 
            background: var(--bg-card);
            padding: 12px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .credit-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .credit-role { 
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .credit-name { 
            font-weight: 500;
            font-size: 14px;
            color: var(--text-primary);
        }

        .expand-btn { 
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 13px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .expand-btn:hover { 
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .expand-btn::after { 
            content: "‚ñº";
            transition: transform 0.3s;
        }

        .expand-btn.active::after { 
            transform: rotate(180deg);
        }

        /* COPY BUTTON */
        .copy-btn { 
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .copy-btn:hover { 
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
        }

        .copy-toolbar { 
            text-align: right;
            margin-bottom: 16px;
        }

        .media-grid { 
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
        }

        .media-item { 
            aspect-ratio: 16/9;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .media-item:hover { 
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-primary);
        }

        .media-item img { 
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        pre { 
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow-x: auto;
            color: #a5d6a7;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 0;
            font-size: 13px;
            line-height: 1.6;
        }

        .missing-msg { 
            text-align: center;
            margin-top: 80px;
            color: var(--text-muted);
            font-size: 18px;
        }

        .empty-state { 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: var(--text-muted);
            font-size: 18px;
            flex-direction: column;
            gap: 16px;
        }

        .empty-state-icon {
            font-size: 64px;
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            #sidebar {
                width: 100%;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="sidebar">
            <!-- App Header -->
            <div class="app-header">
                <h1>Game Explorer</h1>
                <p>Discover and explore game data</p>
            </div>

            <!-- Search -->
            <div id="search-box">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="search-input" placeholder="Search games...">
                </div>
            </div>

            <!-- Filter Toggle -->
            <div class="filter-toggle-section">
                <button class="filter-toggle-btn" id="filter-toggle">
                    <span>‚öôÔ∏è Advanced Filters</span>
                    <span class="filter-badge" id="active-filters">0</span>
                </button>
            </div>

            <!-- Applied Filters Display -->
            <div class="applied-filters" id="applied-filters-display">
                <!-- Dynamically populated -->
            </div>
            <div id="results-count">
                <div class="results-info">
                    <span>üìã</span>
                    <span>Showing <span class="result-number">all</span> games</span>
                </div>
                <button class="export-btn" onclick="exportFilteredGames()">
                    <span>üíæ</span>
                    <span>Export</span>
                </button>
            </div>
            <div id="game-list"></div>
        </div>

        <div id="main">
            <div id="content-wrapper" style="display:none; height: 100%; flex-direction: column;">
                <div id="header">
                    <h1 id="game-title">Game Title</h1>
                </div>
                <div id="tabs"></div>
                <div id="panels-container"></div>
            </div>
            
            <div id="empty-state" class="empty-state">
                <div class="empty-state-icon">üéÆ</div>
                <div>Select a game to view details</div>
            </div>
        </div>
    </div>

    <!-- Filter Side Panel -->
    <div id="filter-panel-overlay"></div>
    <div id="filter-panel">
        <div class="filter-panel-header">
            <button class="filter-panel-close" onclick="closeFilterPanel()">√ó</button>
            <h2 class="filter-panel-title">Advanced Filters</h2>
            <p class="filter-panel-subtitle">Refine your game search</p>
        </div>
        
        <div class="filter-panel-content">
            <!-- Platform Checkboxes -->
            <div class="filter-group">
                <div class="filter-header">
                    <span class="filter-label">üéÆ Platforms</span>
                    <button class="filter-action" onclick="clearPlatforms()">Clear</button>
                </div>
                <input type="text" id="platform-search" placeholder="Search platforms...">
                <div id="platform-list" class="checkbox-container"></div>
            </div>

            <!-- Source Filter -->
            <div class="filter-group">
                <div class="filter-header">
                    <span class="filter-label">üìä Data Sources</span>
                    <button class="filter-action" onclick="clearSources()">Clear</button>
                </div>
                <div id="source-list" class="checkbox-container"></div>
            </div>

            <!-- Minimum Sources Filter -->
            <div class="filter-group">
                <div class="filter-header">
                    <span class="filter-label">üî¢ Min. Source Count</span>
                </div>
                <input type="number" id="min-sources" min="1" value="1" placeholder="1">
                <div class="filter-hint">
                    Show games found in at least this many files
                </div>
            </div>

            <!-- Date Filter -->
            <div class="filter-group">
                <div class="filter-header">
                    <span class="filter-label">üìÖ Release Date</span>
                    <button class="filter-action" onclick="clearDates()">Reset</button>
                </div>
                <div class="date-row">
                    <div class="date-col">
                        <label>From</label>
                        <input type="date" id="filter-date-start">
                    </div>
                    <div class="date-col">
                        <label>To</label>
                        <input type="date" id="filter-date-end">
                    </div>
                </div>
            </div>
        </div>

        <div class="filter-panel-actions">
            <button class="filter-panel-btn filter-panel-btn-secondary" onclick="clearAllFilters()">Clear All</button>
            <button class="filter-panel-btn filter-panel-btn-primary" onclick="closeFilterPanel()">Apply Filters</button>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Export Games</h2>
                <p class="modal-subtitle">Choose your export format</p>
            </div>
            
            <div class="export-options">
                <div class="export-option" onclick="exportAsExcel()">
                    <div class="export-option-icon">üìä</div>
                    <div class="export-option-content">
                        <div class="export-option-title">Excel (Combined Data)</div>
                        <div class="export-option-desc">
                            Export merged data as a spreadsheet with columns for title, release date, platforms, developers, ratings, etc.
                        </div>
                    </div>
                </div>
                
                <div class="export-option" onclick="exportAsJSON()">
                    <div class="export-option-icon">üìÑ</div>
                    <div class="export-option-content">
                        <div class="export-option-title">JSON (Full Raw Data)</div>
                        <div class="export-option-desc">
                            Export complete data including all source files and raw information for advanced use.
                        </div>
                    </div>
                </div>

                <div class="export-option" onclick="exportAsCombinedJSON()">
                    <div class="export-option-icon">üîÄ</div>
                    <div class="export-option-content">
                        <div class="export-option-title">JSON (Combined Only)</div>
                        <div class="export-option-desc">
                            Export only the merged/combined JSON data for each game (one entry per game, no duplicate sources).
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeExportModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Check if DB loaded
        const db = window.GAMES_DB || [];
        if (db.length === 0) {
            console.warn("GAMES_DB is empty. Did you load the script chunks in the <head>?");
        }
        
        // --- DOM Elements ---
        const gameListEl = document.getElementById('game-list');
        const resultsCountEl = document.getElementById('results-count');
        const searchInput = document.getElementById('search-input');
        
        const platformSearchInput = document.getElementById('platform-search');
        const platformListEl = document.getElementById('platform-list');
        
        const sourceListEl = document.getElementById('source-list');
        const minSourcesInput = document.getElementById('min-sources');
        
        const filterDateStart = document.getElementById('filter-date-start');
        const filterDateEnd = document.getElementById('filter-date-end');

        const contentWrapper = document.getElementById('content-wrapper');
        const emptyState = document.getElementById('empty-state');
        const titleEl = document.getElementById('game-title');
        const tabsEl = document.getElementById('tabs');
        const panelsContainer = document.getElementById('panels-container');

        const filterToggle = document.getElementById('filter-toggle');
        const filterPanel = document.getElementById('filter-panel');
        const filterPanelOverlay = document.getElementById('filter-panel-overlay');
        const appliedFiltersDisplay = document.getElementById('applied-filters-display');
        const activeFiltersCount = document.getElementById('active-filters');

        // Track currently filtered games
        let currentFilteredGames = [];

        // Filter Panel Toggle Logic
        filterToggle.addEventListener('click', () => {
            filterPanel.classList.add('show');
            filterPanelOverlay.classList.add('show');
            document.body.style.overflow = 'hidden'; // Prevent background scroll
        });

        function closeFilterPanel() {
            filterPanel.classList.remove('show');
            filterPanelOverlay.classList.remove('show');
            document.body.style.overflow = '';
            updateAppliedFiltersDisplay();
        }

        // Close on overlay click
        filterPanelOverlay.addEventListener('click', closeFilterPanel);

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && filterPanel.classList.contains('show')) {
                closeFilterPanel();
            }
        });

        function updateAppliedFiltersDisplay() {
            const selectedPlatforms = Array.from(document.querySelectorAll('.platform-chk:checked')).map(cb => cb.value);
            const selectedSources = Array.from(document.querySelectorAll('.source-chk:checked')).map(cb => cb.value);
            const minSourceCount = parseInt(minSourcesInput.value) || 1;
            const dateStart = filterDateStart.value;
            const dateEnd = filterDateEnd.value;

            let html = '';

            // Platforms
            if (selectedPlatforms.length > 0) {
                const displayText = selectedPlatforms.length > 3 
                    ? `${selectedPlatforms.slice(0, 3).join(', ')} +${selectedPlatforms.length - 3} more`
                    : selectedPlatforms.join(', ');
                html += `
                    <div class="applied-filter-item">
                        <span class="applied-filter-label">Platforms</span>
                        <span class="applied-filter-value" title="${selectedPlatforms.join(', ')}">${displayText}</span>
                        <button class="applied-filter-clear" onclick="clearPlatforms()" title="Clear platforms">√ó</button>
                    </div>
                `;
            }

            // Sources
            if (selectedSources.length > 0) {
                const displayText = selectedSources.map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(', ');
                html += `
                    <div class="applied-filter-item">
                        <span class="applied-filter-label">Sources</span>
                        <span class="applied-filter-value" title="${displayText}">${displayText}</span>
                        <button class="applied-filter-clear" onclick="clearSources()" title="Clear sources">√ó</button>
                    </div>
                `;
            }

            // Min Sources
            if (minSourceCount > 1) {
                html += `
                    <div class="applied-filter-item">
                        <span class="applied-filter-label">Min Sources</span>
                        <span class="applied-filter-value">${minSourceCount}</span>
                        <button class="applied-filter-clear" onclick="clearMinSources()" title="Clear min sources">√ó</button>
                    </div>
                `;
            }

            // Date Range
            if (dateStart || dateEnd) {
                const dateText = dateStart && dateEnd 
                    ? `${dateStart} to ${dateEnd}`
                    : dateStart 
                        ? `From ${dateStart}`
                        : `Until ${dateEnd}`;
                html += `
                    <div class="applied-filter-item">
                        <span class="applied-filter-label">Release Date</span>
                        <span class="applied-filter-value">${dateText}</span>
                        <button class="applied-filter-clear" onclick="clearDates()" title="Clear dates">√ó</button>
                    </div>
                `;
            }

            if (html) {
                appliedFiltersDisplay.innerHTML = html;
                appliedFiltersDisplay.classList.add('show');
            } else {
                appliedFiltersDisplay.classList.remove('show');
            }
        }

        function clearMinSources() {
            minSourcesInput.value = 1;
            filterGames();
            updateActiveFiltersCount();
            updateAppliedFiltersDisplay();
        }

        function clearAllFilters() {
            clearPlatforms();
            clearSources();
            clearMinSources();
            clearDates();
        }

        // Export Function
        function exportFilteredGames() {
            if (currentFilteredGames.length === 0) {
                alert('No games to export!');
                return;
            }
            
            // Show export modal
            document.getElementById('export-modal').classList.add('show');
        }

        function closeExportModal() {
            document.getElementById('export-modal').classList.remove('show');
        }

        // Close modal on background click
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('export-modal').addEventListener('click', (e) => {
                if (e.target.id === 'export-modal') {
                    closeExportModal();
                }
            });
        });

        function exportAsJSON() {
            // Create export data with full JSON
            const exportData = currentFilteredGames.map(game => ({
                display_name: game.display_name,
                sources: game.sources
            }));

            // Convert to JSON string
            const jsonString = JSON.stringify(exportData, null, 2);
            
            // Create blob and download
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            // Generate filename with timestamp and filter info
            const timestamp = new Date().toISOString().slice(0, 10);
            const count = currentFilteredGames.length;
            a.download = `games_export_full_${count}_${timestamp}.json`;
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            closeExportModal();
        }

        function exportAsExcel() {
            // Prepare data for Excel export
            const rows = [];
            
            // Header row
            rows.push([
                'Title',
                'Release Date',
                'Platforms',
                'Developers',
                'Publishers',
                'Genres',
                'Tags',
                'IMDb Rating',
                'IMDb Votes',
                'RAWG Rating',
                'RAWG Votes',
                'Content Rating',
                'Description',
                'Website',
                'IMDb ID',
                'RAWG ID',
                'MobyGames URL'
            ]);

            // Data rows
            currentFilteredGames.forEach(game => {
                const combined = game.sources.combined || {};
                const info = combined.basic_info || {};
                const metrics = combined.metrics || {};
                const classif = combined.classification || {};
                const comps = combined.companies || {};
                
                rows.push([
                    info.title || game.display_name || '',
                    info.release_date || '',
                    (combined.platforms || []).map(p => normalizePlatform(p)).join(', '),
                    (comps.developers || []).join(', '),
                    (comps.publishers || []).join(', '),
                    (classif.genres || []).join(', '),
                    (classif.tags || []).slice(0, 10).join(', '),
                    metrics.rating_imdb || '',
                    metrics.vote_count_imdb || '',
                    metrics.rating_rawg || '',
                    metrics.vote_count_rawg || '',
                    classif.content_rating || '',
                    info.description || '',
                    info.website || '',
                    info.ids?.imdb || '',
                    info.ids?.rawg || '',
                    info.ids?.mobygames || ''
                ]);
            });

            // Convert to CSV
            const csvContent = rows.map(row => 
                row.map(cell => {
                    // Escape quotes and wrap in quotes if contains comma, quote, or newline
                    const cellStr = String(cell);
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        return `"${cellStr.replace(/"/g, '""')}"`;
                    }
                    return cellStr;
                }).join(',')
            ).join('\n');

            // Create blob and download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            const timestamp = new Date().toISOString().slice(0, 10);
            const count = currentFilteredGames.length;
            a.download = `games_export_${count}_${timestamp}.csv`;
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            closeExportModal();
        }

        // --- PLATFORM NORMALIZATION MAP ---
        const PLATFORM_MAP = {
            // --- NINTENDO ---
            "nes": "NES",
            "entertainment system": "NES",
            "entertainment system (nes)": "NES",
            "snes": "SNES",
            "super nintendo": "SNES",
            "super entertainment system": "SNES",
            "n64": "Nintendo 64",
            "64": "Nintendo 64",
            "nintendo 64": "Nintendo 64",
            "gamecube": "GameCube",
            "ngc": "GameCube",
            "wii": "Wii",
            "wii u": "Wii U",
            "switch": "Nintendo Switch",
            "nintendo switch": "Nintendo Switch",
            "switch 2": "Nintendo Switch 2",
            
            // Nintendo Handhelds
            "gb": "Game Boy",
            "game boy": "Game Boy",
            "gba": "Game Boy Advance",
            "game boy advance": "Game Boy Advance",
            "game boy color": "Game Boy Color",
            "ds": "Nintendo DS",
            "nintendo ds": "Nintendo DS",
            "dsi": "Nintendo DSi",
            "3ds": "Nintendo 3DS",
            "3ds": "Nintendo 3DS", 
            "new nintendo 3ds": "Nintendo 3DS",
            "game & watch": "Game & Watch",
            "pokemon mini": "Pok√©mon mini",

            // --- PLAYSTATION ---
            "ps1": "PlayStation 1",
            "playstation": "PlayStation 1",
            "ps2": "PlayStation 2",
            "playstation 2": "PlayStation 2",
            "ps3": "PlayStation 3",
            "playstation 3": "PlayStation 3",
            "ps4": "PlayStation 4",
            "playstation 4": "PlayStation 4",
            "ps5": "PlayStation 5",
            "playstation 5": "PlayStation 5",
            "psp": "PSP",
            "playstation portable": "PSP",
            "ps vita": "PS Vita",
            "playstation vita": "PS Vita",
            "playstation vr": "PlayStation VR",
            "playstation vr2": "PlayStation VR2",

            // --- XBOX ---
            "xbox": "Xbox",
            "original xbox": "Xbox",
            "xbox 360": "Xbox 360",
            "microsoft xbox 360": "Xbox 360",
            "x360": "Xbox 360",
            "xbox one": "Xbox One",
            "microsoft xbox one": "Xbox One",
            "xb1": "Xbox One",
            "xbox series": "Xbox Series X/S",
            "xbox series x": "Xbox Series X/S",
            "xbox series s": "Xbox Series X/S",
            "microsoft xbox series x": "Xbox Series X/S",
            
            // --- SEGA ---
            "master system": "Sega Master System",
            "sega master system": "Sega Master System",
            "genesis": "Sega Genesis",
            "sega genesis": "Sega Genesis",
            "sega mega drive/genesis": "Sega Genesis",
            "sega saturn": "Sega Saturn",
            "dreamcast": "Dreamcast",
            "game gear": "Game Gear",
            "sega 32x": "Sega 32X",
            "sega cd": "Sega CD",

            // --- PC / COMPUTER ---
            "pc": "PC",
            "windows": "PC",
            "pc (microsoft windows)": "PC",
            "windows apps": "PC",
            "dos": "DOS",
            "ms-dos": "DOS",
            "pc booter": "DOS",
            "mac": "Mac",
            "macos": "Mac",
            "classic macintosh": "Mac",
            "apple ii": "Apple II",
            "apple ii": "Apple II",
            "linux": "Linux",
            "commodore 64": "Commodore 64",
            "commodore c64/128/max": "Commodore 64",
            "commodore 16, plus/4": "Commodore 16",
            "commodore pet/cbm": "Commodore PET",
            "amiga": "Amiga",
            "commodore / amiga": "Amiga",
            "amiga cd32": "Amiga CD32",
            "atari st": "Atari ST",
            "atari st/ste": "Atari ST",
            "zx spectrum": "ZX Spectrum",
            "sinclair zx spectrum": "ZX Spectrum",
            "zx spectrum next": "ZX Spectrum Next",
            "amstrad cpc": "Amstrad CPC",
            "msx": "MSX",
            "pc-98": "PC-98",
            "x68000": "Sharp X68000",
            "fm towns": "FM Towns",

            // --- ATARI ---
            "atari 2600": "Atari 2600",
            "atari vcs": "Atari 2600",
            "atari 5200": "Atari 5200",
            "atari 7800": "Atari 7800",
            "atari 8-bit": "Atari 8-bit",
            "atari jaguar": "Atari Jaguar",
            "atari lynx": "Atari Lynx",
            "lynx": "Atari Lynx",

            // --- MOBILE ---
            "ios": "iOS",
            "iphone": "iOS",
            "ipad": "iOS",
            "android": "Android",
            "windows phone": "Windows Mobile",
            "windows mobile": "Windows Mobile",
            "blackberry": "BlackBerry",
            "j2me": "Java Mobile (J2ME)",
            "palm os": "Palm OS",
            "symbian": "Symbian",

            // --- VR / OTHERS ---
            "oculus quest": "Meta Quest",
            "meta quest 2": "Meta Quest",
            "meta quest 3": "Meta Quest",
            "quest": "Meta Quest",
            "oculus rift": "Oculus Rift",
            "steamvr": "SteamVR",
            "browser": "Web Browser",
            "web": "Web Browser",
            "web browser": "Web Browser",
            "arcade": "Arcade",
            "neo geo": "Neo Geo",
            "neo geo aes": "Neo Geo",
            "neo geo mvs": "Neo Geo",
            "neo geo cd": "Neo Geo CD",
            "stadia": "Google Stadia",
            "google stadia": "Google Stadia",
            "xbox cloud gaming": "Xbox Cloud",
            "ouya": "Ouya",
            "intellivision": "Intellivision",
            "colecovision": "ColecoVision",
            "turbografx-16": "TurboGrafx-16",
            "turbografx cd": "TurboGrafx CD",
            "3do": "3DO Interactive Multiplayer"
        };

        function normalizePlatform(p) {
            if (!p) return "Unknown";
            const lower = p.toLowerCase().trim();
            return PLATFORM_MAP[lower] || p.charAt(0).toUpperCase() + p.slice(1);
        }

        // --- INITIALIZATION ---
        populatePlatformCheckboxes();
        populateSourceCheckboxes();
        currentFilteredGames = db;
        renderGameList(db);
        updateActiveFiltersCount();
        updateAppliedFiltersDisplay();

        // --- FILTER SETUP ---
        
        function populatePlatformCheckboxes() {
            const allPlatforms = new Set();
            
            db.forEach(game => {
                if(game.sources.combined && game.sources.combined.platforms) {
                    game.sources.combined.platforms.forEach(p => {
                        allPlatforms.add(normalizePlatform(p));
                    });
                } 
                else {
                    Object.values(game.sources).forEach(src => {
                        if(src.platforms && Array.isArray(src.platforms)) {
                            src.platforms.forEach(p => allPlatforms.add(normalizePlatform(p)));
                        }
                        if(src.platform) allPlatforms.add(normalizePlatform(src.platform));
                    });
                }
            });
            
            const sorted = Array.from(allPlatforms).sort();
            
            platformListEl.innerHTML = '';
            sorted.forEach(p => {
                const label = document.createElement('label');
                label.className = 'checkbox-item';
                
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.value = p; 
                input.className = 'platform-chk';
                input.addEventListener('change', () => {
                    filterGames();
                    updateActiveFiltersCount();
                    updateAppliedFiltersDisplay();
                });

                label.appendChild(input);
                label.appendChild(document.createTextNode(p));
                platformListEl.appendChild(label);
            });
        }

        function populateSourceCheckboxes() {
            const allSources = new Set();
            db.forEach(game => {
                if(game.sources) {
                    Object.keys(game.sources).forEach(k => {
                        if (k !== 'combined') allSources.add(k);
                    });
                }
            });
            
            const sorted = Array.from(allSources).sort();
            
            sourceListEl.innerHTML = '';
            sorted.forEach(s => {
                const label = document.createElement('label');
                label.className = 'checkbox-item';
                
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.value = s;
                input.className = 'source-chk';
                input.addEventListener('change', () => {
                    filterGames();
                    updateActiveFiltersCount();
                    updateAppliedFiltersDisplay();
                });

                label.appendChild(input);
                const displayName = s.charAt(0).toUpperCase() + s.slice(1);
                label.appendChild(document.createTextNode(displayName));
                sourceListEl.appendChild(label);
            });
        }

        // Platform Search Listener
        platformSearchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const items = platformListEl.querySelectorAll('.checkbox-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if(text.includes(term)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        });

        function clearPlatforms() {
            document.querySelectorAll('.platform-chk').forEach(cb => cb.checked = false);
            platformSearchInput.value = ''; 
            platformListEl.querySelectorAll('.checkbox-item').forEach(i => i.classList.remove('hidden'));
            filterGames();
            updateActiveFiltersCount();
            updateAppliedFiltersDisplay();
        }

        function clearSources() {
            document.querySelectorAll('.source-chk').forEach(cb => cb.checked = false);
            filterGames();
            updateActiveFiltersCount();
            updateAppliedFiltersDisplay();
        }

        function clearDates() {
            filterDateStart.value = '';
            filterDateEnd.value = '';
            filterGames();
            updateActiveFiltersCount();
            updateAppliedFiltersDisplay();
        }

        function updateActiveFiltersCount() {
            let count = 0;
            
            // Count selected platforms
            count += document.querySelectorAll('.platform-chk:checked').length;
            
            // Count selected sources
            count += document.querySelectorAll('.source-chk:checked').length;
            
            // Count date filters
            if (filterDateStart.value) count++;
            if (filterDateEnd.value) count++;
            
            // Count min sources if not default
            if (parseInt(minSourcesInput.value) > 1) count++;
            
            activeFiltersCount.textContent = count;
            
            if (count > 0) {
                filterToggle.classList.add('active');
            } else {
                filterToggle.classList.remove('active');
            }
        }

        function filterGames() {
            const term = searchInput.value.toLowerCase();
            const dateStart = filterDateStart.value;
            const dateEnd = filterDateEnd.value;
            
            const selectedPlatforms = Array.from(document.querySelectorAll('.platform-chk:checked')).map(cb => cb.value);
            const selectedSources = Array.from(document.querySelectorAll('.source-chk:checked')).map(cb => cb.value);
            const minSourceCount = parseInt(minSourcesInput.value) || 1;

            const filtered = db.filter(g => {
                const combined = g.sources.combined || {};
                const sourceKeys = Object.keys(g.sources).filter(k => k !== 'combined');

                // 1. Text Search
                if (!g.display_name.toLowerCase().includes(term)) return false;

                // 2. Platform Filter (NORMALIZED)
                if (selectedPlatforms.length > 0) {
                    let gameRawPlatforms = [];
                    if (combined.platforms) {
                        gameRawPlatforms = combined.platforms;
                    } else {
                        Object.values(g.sources).forEach(s => {
                            if(s.platforms) gameRawPlatforms.push(...s.platforms);
                            if(s.platform) gameRawPlatforms.push(s.platform);
                        });
                    }

                    const gameNormPlatforms = gameRawPlatforms.map(p => normalizePlatform(p));
                    const hasMatch = selectedPlatforms.some(sp => gameNormPlatforms.includes(sp));
                    if (!hasMatch) return false;
                }

                // 3. Source Filter
                if (selectedSources.length > 0) {
                    const hasSourceMatch = selectedSources.some(src => g.sources.hasOwnProperty(src));
                    if (!hasSourceMatch) return false;
                }

                // 4. Min Source Count
                if (sourceKeys.length < minSourceCount) return false;

                // 5. Date Filter
                if (dateStart || dateEnd) {
                    const gDate = combined.basic_info ? combined.basic_info.release_date : null;
                    if (!gDate) return false; 
                    
                    if (dateStart && gDate < dateStart) return false;
                    if (dateEnd && gDate > dateEnd) return false;
                }

                return true;
            });

            // Store filtered results for export
            currentFilteredGames = filtered;

            const countText = filtered.length === db.length ? 'all' : filtered.length;
            resultsCountEl.innerHTML = `
                <div class="results-info">
                    <span>üìã</span>
                    <span>Showing <span class="result-number">${countText}</span> of ${db.length} games</span>
                </div>
                <button class="export-btn" onclick="exportFilteredGames()">
                    <span>üíæ</span>
                    <span>Export</span>
                </button>
            `;
            renderGameList(filtered);
        }

        // Event Listeners
        searchInput.addEventListener('input', filterGames);
        filterDateStart.addEventListener('change', () => {
            filterGames();
            updateActiveFiltersCount();
            updateAppliedFiltersDisplay();
        });
        filterDateEnd.addEventListener('change', () => {
            filterGames();
            updateActiveFiltersCount();
            updateAppliedFiltersDisplay();
        });
        minSourcesInput.addEventListener('input', () => {
            filterGames();
            updateActiveFiltersCount();
            updateAppliedFiltersDisplay();
        });

        // --- RENDERING LOGIC ---

        function renderGameList(games) {
            gameListEl.innerHTML = '';
            
            if(games.length === 0) {
                gameListEl.innerHTML = '<div style="padding:40px; text-align:center; color:var(--text-muted)">No games found</div>';
                return;
            }

            games.forEach(game => {
                const hasCombined = game.sources && game.sources.combined;
                const sourceCount = Object.keys(game.sources).filter(k=>k!=='combined').length;
                
                const div = document.createElement('div');
                div.className = 'game-item';
                div.innerHTML = `
                    <div class="game-title">${game.display_name}</div>
                    <div class="game-meta">
                        ${hasCombined ? '<span class="source-badge">Merged</span>' : ''}
                        <span>${sourceCount} source${sourceCount !== 1 ? 's' : ''}</span>
                    </div>
                `;
                div.onclick = () => loadGame(game, div);
                gameListEl.appendChild(div);
            });
        }

        function loadGame(game, clickedEl) {
            document.querySelectorAll('.game-item').forEach(el => el.classList.remove('active'));
            clickedEl.classList.add('active');
            emptyState.style.display = 'none';
            contentWrapper.style.display = 'flex';
            
            titleEl.textContent = game.display_name;
            if(game.sources.combined && game.sources.combined.basic_info && game.sources.combined.basic_info.title){
                 titleEl.textContent = game.sources.combined.basic_info.title;
            }

            renderTabs(game);
        }

        function renderTabs(game) {
            tabsEl.innerHTML = '';
            panelsContainer.innerHTML = '';

            // 1. Visual Overview
            createTab("Visual Overview", true);
            createVisualPanel(game.sources.combined, true);

            // 2. COMBINED JSON (RAW)
            if (game.sources && game.sources.combined) {
                createTab("COMBINED", false);
                createRawPanel("COMBINED", game.sources.combined);
            }

            // 3. Individual Sources
            const sourceKeys = Object.keys(game.sources)
                .filter(k => k !== 'combined')
                .sort();

            const getCleanLabel = (rawName) => {
                let s = rawName;
                s = s.replace(/[-_\s]+\d+$/, '');
                return s.toUpperCase();
            };

            const labelCounts = {};

            sourceKeys.forEach(sourceKey => {
                const cleanName = getCleanLabel(sourceKey);
                labelCounts[cleanName] = (labelCounts[cleanName] || 0) + 1;

                const displayName =
                    labelCounts[cleanName] > 1
                        ? `${cleanName} (${labelCounts[cleanName]})`
                        : cleanName;

                createTab(displayName, false);
                createRawPanel(displayName, game.sources[sourceKey]);
            });
        }

        function createTab(name, isActive) {
            const btn = document.createElement('button');
            btn.className = `tab-btn ${isActive ? 'active' : ''}`;
            btn.textContent = name;
            btn.dataset.target = name;
            btn.onclick = () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                btn.classList.add('active');
                const targetPanel = Array.from(document.querySelectorAll('.panel')).find(p => p.dataset.name === name);
                if(targetPanel) targetPanel.classList.add('active');
            };
            tabsEl.appendChild(btn);
        }

        function createVisualPanel(data, isActive) {
            const panel = document.createElement('div');
            panel.className = `panel ${isActive ? 'active' : ''}`;
            panel.dataset.name = "Visual Overview";

            if (!data) {
                panel.innerHTML = `<div class="missing-msg"><p>No merged data found.</p></div>`;
                panelsContainer.appendChild(panel);
                return;
            }

            const info = data.basic_info || {};
            const media = data.media || {};
            const metrics = data.metrics || {};
            const classif = data.classification || {};
            const comps = data.companies || {};
            
            const getVal = (v, suffix='') => v ? `${v}${suffix}` : '<span style="color:var(--text-muted)">-</span>';
            const dateStr = info.release_date || "Unknown Date";

            let html = `
                <div class="dashboard-grid">
                    <div class="dashboard-left">
                        <div class="poster-card">
                            <img src="${media.poster || media.box_art || 'assests/no-poster.PNG'}">
                        </div>
                        <table class="data-table">
                            <tr><th>Released</th><td>${dateStr}</td></tr>
                            <tr><th>Rating</th><td>${getVal(classif.content_rating)}</td></tr>
                        </table>
                        <div>
                            <div class="section-title">üîó External Links</div>
                            <div class="pill-container">
                                ${ info.website ? `<span class="pill"><a href="${info.website}" target="_blank">Official Site</a></span>` : '' }
                                ${ info.ids?.imdb ? `<span class="pill"><a href="https://www.imdb.com/title/${info.ids.imdb}" target="_blank">IMDb</a></span>` : '' }
                                ${ info.ids?.rawg ? `<span class="pill"><a href="https://rawg.io/games/${info.ids.rawg}" target="_blank">RAWG</a></span>` : '' }
                                ${ info.ids?.mobygames ? `<span class="pill"><a href="${info.ids.mobygames}" target="_blank">MobyGames</a></span>` : '' }
                            </div>
                        </div>
                        <div style="margin-top:20px;">
                            <div class="section-title">üë®‚Äçüíª Developers</div>
                            <div class="pill-container">
                                ${ (comps.developers || []).map(d => `<span class="pill">${d}</span>`).join('') || '<span style="color:var(--text-muted)">N/A</span>' }
                            </div>
                        </div>
                         <div>
                            <div class="section-title">üè¢ Publishers</div>
                            <div class="pill-container">
                                ${ (comps.publishers || []).map(d => `<span class="pill">${d}</span>`).join('') || '<span style="color:var(--text-muted)">N/A</span>' }
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-right">
                        <div style="margin-bottom: 25px;">
                            <p style="font-size: 15px; line-height: 1.7; color: var(--text-secondary); margin-top:0;">
                                ${ (info.description || 'No description available.').replace(/\n/g, '<br>') }
                            </p>
                        </div>
                        <div class="stats-row">
                            <div class="stat-card">
                                <div class="stat-value" style="color:#f5c518">${getVal(metrics.rating_imdb)}</div>
                                <div class="stat-label">IMDb Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${getVal(metrics.vote_count_imdb)}</div>
                                <div class="stat-label">IMDb Votes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" style="color:#ff6b6b">${getVal(metrics.rating_rawg)}</div>
                                <div class="stat-label">RAWG Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${getVal(metrics.vote_count_rawg)}</div>
                                <div class="stat-label">RAWG Votes</div>
                            </div>
                        </div>
                        <div>
                            <div class="section-title">üéØ Genres & Tags</div>
                            <div class="pill-container">
                                ${ (classif.genres || []).map(g => `<span class="pill genre">${g}</span>`).join('') }
                                ${ (classif.tags || []).slice(0, 15).map(t => `<span class="pill">${t}</span>`).join('') }
                            </div>
                        </div>
                        <div>
                            <div class="section-title">üéÆ Platforms</div>
                            <div class="pill-container">
                                ${ (data.platforms || []).map(p => `<span class="pill platform">${normalizePlatform(p)}</span>`).join('') }
                            </div>
                        </div>
                        ${ renderCredits(data.credits) }
                        ${ renderGallery(media.screenshots) }
                        ${ renderVideos(media.videos) }
                    </div>
                </div>
            `;
            panel.innerHTML = html;
            panelsContainer.appendChild(panel);
        }

        function renderCredits(credits) {
            if (!credits) return '';
            const bfi = credits.bfi_cultural_test_leads || {};
            const roster = credits.roster || [];
            const bfiMap = {
                project_leader: "Project Leader / Director",
                scriptwriter: "Scriptwriter / Narrative",
                composer: "Composer",
                lead_artist: "Lead Artist",
                lead_programmer: "Lead Programmer",
                lead_designer: "Lead Designer"
            };

            let bfiHtml = '';
            let hasBfi = false;
            for (const [key, label] of Object.entries(bfiMap)) {
                if (bfi[key] && bfi[key].length > 0) {
                    hasBfi = true;
                    bfiHtml += `<div class="bfi-card"><span class="bfi-role">${label}</span><span class="bfi-name">${bfi[key].join(', ')}</span></div>`;
                }
            }

            let rosterHtml = '';
            roster.forEach(person => {
                rosterHtml += `<div class="credit-item"><span class="credit-role">${person.role}</span><span class="credit-name">${person.name}</span></div>`;
            });

            let finalHtml = `<div style="margin-top:25px"><div class="section-title">üë• Credits & Crew</div>`;
            if (hasBfi) finalHtml += `<div class="bfi-grid">${bfiHtml}</div>`;
            if (roster.length > 0) {
                const uid = "credits-" + Math.random().toString(36).substr(2, 9);
                finalHtml += `<button class="expand-btn" onclick="toggleCredits('${uid}', this)">Show Full Staff List (${roster.length})</button><div id="${uid}" class="credits-grid">${rosterHtml}</div>`;
            }
            finalHtml += `</div>`;
            return finalHtml;
        }

        function toggleCredits(id, btn) {
            const el = document.getElementById(id);
            if (el.classList.contains('show')) {
                el.classList.remove('show');
                btn.classList.remove('active');
                btn.textContent = btn.textContent.replace("Hide", "Show");
            } else {
                el.classList.add('show');
                btn.classList.add('active');
                btn.textContent = btn.textContent.replace("Show", "Hide");
            }
        }

        function renderGallery(images) {
            if (!images || images.length === 0) return '';
            let html = `<div style="margin-top:30px"><div class="section-title">üñºÔ∏è Gallery</div><div class="media-grid">`;
            images.slice(0, 8).forEach(img => html += `<div class="media-item"><img src="${img}" loading="lazy" onclick="window.open('${img}', '_blank')"></div>`);
            html += `</div></div>`;
            return html;
        }

        function renderVideos(videos) {
            if (!videos || videos.length === 0) return '';
            let html = `<div style="margin-top:20px"><div class="section-title">üé¨ Videos</div><div style="display:flex; flex-direction:column; gap:10px;">`;
            videos.forEach(v => html += `<a href="${v.url}" target="_blank" style="color:var(--accent-primary); text-decoration:none; transition: color 0.2s;" onmouseover="this.style.color='var(--accent-secondary)'" onmouseout="this.style.color='var(--accent-primary)'">‚ñ∂ ${v.name || 'Watch Trailer'}</a>`);
            html += `</div></div>`;
            return html;
        }

        function safeStringify(obj) {
            const seen = new WeakSet();
            return JSON.stringify(obj, (key, value) => {
                if (typeof value === 'bigint') return value.toString();
                if (typeof value === 'object' && value !== null) {
                    if (seen.has(value)) return '[Circular]';
                    seen.add(value);
                }
                return value;
            }, 4);
        }

        function createRawPanel(name, data) {
            const panel = document.createElement('div');
            panel.className = 'panel';
            panel.dataset.name = name;
            
            const toolbar = document.createElement('div');
            toolbar.className = 'copy-toolbar';
            const btn = document.createElement('button');
            btn.className = 'copy-btn';
            btn.textContent = 'üìã Copy JSON';
            let jsonString;
            try {
                jsonString = safeStringify(data);
            } catch (e) {
                jsonString = `<< Failed to serialize JSON >>\n${e.message}`;
            }
                        
            btn.onclick = () => {
                navigator.clipboard.writeText(jsonString).then(() => {
                    btn.textContent = '‚úì Copied!';
                    btn.style.background = 'var(--success)';
                    btn.style.color = '#fff';
                    setTimeout(() => { btn.textContent = 'üìã Copy JSON'; btn.style.background = ''; btn.style.color = ''; }, 2000);
                });
            };
            
            toolbar.appendChild(btn);
            panel.appendChild(toolbar);
            const pre = document.createElement('pre');
            pre.textContent = jsonString;
            panel.appendChild(pre);
            panelsContainer.appendChild(panel);
        }
    </script>
</body>
</html>